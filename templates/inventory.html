{% extends "base.html" %}

{% block title %}Inventory - TireTrack Pro{% endblock %}

{% block content %}
<div class="inventory-container">
    <div class="page-header">
        <h1><i class="fas fa-boxes"></i> Tire Inventory</h1>
        {% if current_user.role in ['admin', 'sales'] %}
        <a href="{{ url_for('add_tire') }}" class="btn btn-primary">
            <i class="fas fa-plus-circle"></i> Add New Tire
        </a>
        {% endif %}
    </div>
    
    <div class="inventory-stats">
        <div class="stat-item">
            <i class="fas fa-th"></i>
            <span>{{ tires|length }} Tire Types</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-cubes"></i>
            <span>{{ tires|sum(attribute='quantity_in_stock') }} Total Units</span>
        </div>
    </div>
    
    <div class="inventory-list">
        {% for tire in tires %}
        <div class="tire-card">
            <div class="tire-header">
                <div class="tire-title">
                    <h3>{{ tire.brand }} {{ tire.model }}</h3>
                    <span class="tire-size">{{ tire.size }}</span>
                </div>
                <span class="type-badge {{ tire.type|lower|replace(' ', '-') }}">
                    {{ tire.type }}
                </span>
            </div>
            
            <div class="tire-details">
                <div class="detail-row">
                    <div class="detail-item">
                        <i class="fas fa-warehouse"></i>
                        <strong>Stock:</strong>
                        <span class="stock-value {% if tire.quantity_in_stock <= tire.reorder_level %}low-stock{% endif %}">
                            {{ tire.quantity_in_stock }} units
                        </span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-redo-alt"></i>
                        <strong>Reorder Level:</strong>
                        <span>{{ tire.reorder_level }}</span>
                    </div>
                    {% if tire.warehouse_location %}
                    <div class="detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <strong>Location:</strong>
                        <span>{{ tire.warehouse_location }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="detail-row">
                    {% if current_user.role in ['admin', 'accounting'] %}
                    <div class="detail-item">
                        <i class="fas fa-dollar-sign"></i>
                        <strong>Wholesale:</strong>
                        <span class="price">${{ "%.2f"|format(tire.wholesale_price) }}</span>
                    </div>
                    {% endif %}
                    <div class="detail-item">
                        <i class="fas fa-tag"></i>
                        <strong>Retail:</strong>
                        <span class="price retail">${{ "%.2f"|format(tire.retail_price) }}</span>
                    </div>
                    {% if current_user.role in ['admin', 'accounting'] %}
                    <div class="detail-item">
                        <i class="fas fa-chart-line"></i>
                        <strong>Margin:</strong>
                        <span class="margin">{{ "%.1f"|format((tire.retail_price - tire.wholesale_price) / tire.wholesale_price * 100) }}%</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="detail-row">
                    <div class="detail-item">
                        <i class="fas fa-truck"></i>
                        <strong>Supplier:</strong>
                        <span>{{ tire.supplier }}</span>
                    </div>
                    {% if tire.supplier_part_number %}
                    <div class="detail-item">
                        <i class="fas fa-barcode"></i>
                        <strong>Part #:</strong>
                        <span>{{ tire.supplier_part_number }}</span>
                    </div>
                    {% endif %}
                </div>
                
                {% if tire.speed_rating or tire.load_index %}
                <div class="detail-row">
                    {% if tire.speed_rating %}
                    <div class="detail-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <strong>Speed Rating:</strong>
                        <span>{{ tire.speed_rating }}</span>
                    </div>
                    {% endif %}
                    {% if tire.load_index %}
                    <div class="detail-item">
                        <i class="fas fa-weight-hanging"></i>
                        <strong>Load Index:</strong>
                        <span>{{ tire.load_index }}</span>
                    </div>
                    {% endif %}
                    {% if tire.warranty_months %}
                    <div class="detail-item">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Warranty:</strong>
                        <span>{{ tire.warranty_months }} months</span>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if tire.description %}
                <div class="tire-description">
                    <p>{{ tire.description }}</p>
                </div>
                {% endif %}
            </div>
            
            {% if current_user.role in ['admin', 'sales'] %}
            <div class="tire-actions">
                <a href="{{ url_for('edit_tire', tire_id=tire.id) }}" class="btn btn-secondary btn-sm">
                    <i class="fas fa-edit"></i> Edit
                </a>
                {% if current_user.role == 'admin' %}
                <form method="POST" action="{{ url_for('delete_tire', tire_id=tire.id) }}" 
                      style="display: inline;" 
                      onsubmit="return confirm('Are you sure you want to delete this tire?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </form>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
